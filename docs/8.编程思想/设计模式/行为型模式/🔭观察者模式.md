# ğŸ”­è§‚å¯Ÿè€…æ¨¡å¼(å‘å¸ƒ/è®¢é˜…)
> UIç¼–ç¨‹æœ€å¸¸ç”¨

DOMäº‹ä»¶å’ŒVue/Reactç”Ÿå‘½å‘¨æœŸéƒ½æ˜¯ã€‚
```html
<button id="btn">btn</button>
<script>
  const $btn = $('#btn')
  $btn.click(function() {
    console.log(1)
  })
  $btn.click(function() {
    console.log(2)
  })
  $btn.click(function() {
    console.log(3)
  })
</script>
```

## ç¤ºä¾‹
```ts
class Subject {
    private state: number = 0 
    private observers: Observer[] = []
    getState(): number {
        return this.state
    }
    setState(newState: number) {
        this.state = newState
        this.notify()
    }
    attach(observer: Observer) {
        this.observers.push(observer)
    }
    private notify() {
        this.observers.forEach(observer => {
            observer.update(this.state)
        })
    }
}
// 1:n
class Observer {
    name: string
    constructor(name: string) {
        this.name = name
    }
    update(state: number) {
        console.log(`My name is ${this.name}, my state is ${state}`)
    }
} 

const sub = new Subject();
const observer1 = new Observer('barry');
sub.attach(observer1);
const observer2 = new Observer('merry');
sub.attach(observer2);

sub.setState(19960402)
```

[SO](./assets/drowio/Subject_Observer.drawio ':include :type=code')


æ˜¯å¦ç¬¦åˆè®¾è®¡åŸåˆ™
- Observerå’ŒSubject**åˆ†ç¦»ï¼Œè§£è€¦**
- Observerå¯è‡ªç”±æ‰©å±•
- Subjectå¯è‡ªç”±æ‰©å±•

## `åœºæ™¯`
DOMäº‹ä»¶
Vue/Reactç»„ä»¶ç”Ÿå‘½å‘¨æœŸ
![](https://cn.vuejs.org/assets/lifecycle.16e4c08e.png)
Vue-watchå’ŒwatchEffect
[watch](https://cn.vuejs.org/guide/essentials/watchers.html)
Vueç»„ä»¶æ›´æ–°è¿‡ç¨‹
> PS: Reactç»„ä»¶çš„æ›´æ–°è¿‡ç¨‹ä¸æ˜¯ï¼Œæ˜¯ä¸»åŠ¨é€šè¿‡`setState`è§¦å‘çš„ï¼Œè€Œéå“åº”å¼ç›‘å¬ã€‚

![Vue](https://ask.qcloudimg.com/http-save/yehe-3656368/4e2f2a5c51723b209f9a28bdeaebb0a4.png?imageView2/2/w/1620)
å„ç§å¼‚æ­¥å›è°ƒ
- å®šæ—¶å™¨setTimeout setInterval
- Promise.then
- Nodejs - stream readline httpServer
- MutationObserver

**Node**
```js
const fs = require('fs')
const readStream = fs.createReadStream('../README.md')
// æ–‡å­—çš„å­—ç¬¦é•¿åº¦
let length = 0
readStream.on('data', function(chunk) {
  // æ¯æ¬¡æœ€å¤§è¯»å–65536ä¸ªå­—ç¬¦
  const currentLength = chunk.toString().length;
  console.log('current length', currentLength)
  length += currentLength
})
readStream.on('end', function() {
  console.log(length)
})
```
ä¿®æ”¹ä¸ºæŒ‰ç…§è¡Œæ•°æ¥
```js
const readline = require('readline')
const fs = require('fs')
const rl = readline.createInterface({
  input: fs.createReadStream('./README.md')
})
// æ–‡ä»¶æœ‰å¤šå°‘è¡Œ
let lineNum = 0
rl.on('line', function(line) {
  lineNum++
})
rl.on('close', function() {
  console.log('lineNum', lineNum)
})
```

http.server
```js
const http  = require('http')

// http
function serverCallback(req, res) {
  console.log('url', req.url)
  res.end('hello')
}

http.createServer(serverCallback).listen(8080)
console.log('listen 8080 port')
```


**MutationObserverç›‘å¬DOMå˜åŒ–**
```html
<html>
  <head></head>
  <title></title>
  <body>
    <div class="container">
      <h1>test</h1>
      <p>demo</p>
      <p>good</p>
    </div>
  </body>
</html>
```
```js
// mutationObserverçš„å›è°ƒå‡½æ•°
function callback(records: MutationRecord[], observer: MutationObserver) {
  for (let record of records) {
    console.log('record', record);
  }
}

const observer = new MutationObserver(callback); // nodejs httpserver

const elem = document.getElementById('container')
if (elem) {
  // å¼€å§‹å¯åŠ¨ç›‘å¬
  observer.observe(elem, {
    attributes: true, // ç›‘å¬å±æ€§å˜åŒ–
    attributeOldValue: true, // å˜åŒ–ä¹‹åï¼Œè®°å½•æ—§çš„å±æ€§å€¼
    childList: true,  // ç›‘å¬å­èŠ‚ç‚¹çš„å˜åŒ–ï¼ˆå¢åŠ ï¼Œåˆ é™¤ï¼‰
    characterData: true, // ç›‘å¬èŠ‚ç‚¹çš„å†…å®¹æˆ–æ–‡æœ¬å˜åŒ–
    subtree: true, // é€’å½’ç›‘å¬ä¸‹çº§æ‰€æœ‰èŠ‚ç‚¹
  })
}

// åœæ­¢ç›‘å¬
// observe.disconnect()
```
æ“ä½œéªŒè¯ç›‘å¬ï¼šåœ¨æµè§ˆå™¨æ§åˆ¶å°
```js
// æ“ä½œä¸€
const container = document.getElementById('container')
container.innerHtml = 'come on'
// æ“ä½œäºŒ
const p1 = document.createElement('p')
p1.innerHtml = 'beStrong'
container.appendChild(p1)
```

## è§‚å¯Ÿè€…VSå‘å¸ƒè®¢é˜…
- å‘å¸ƒè®¢é˜…ä¸å±äºä¼ ç»Ÿçš„23ç§è®¾è®¡æ¨¡å¼
- æ˜¯è§‚å¯Ÿè€…æ¨¡å¼çš„å¦ä¸€ç§å®ç°å½¢å¼
- è§‚å¯Ÿè€…ï¼šSå’ŒOç›´æ¥ç»‘å®šï¼Œæ— ä¸­ä»‹åª’ä»‹
  - å¦‚`addEventListener`ç»‘å®šäº‹ä»¶
- å‘å¸ƒè®¢é˜…ï¼šPå’ŒOäº’ç›¸ä¸è®¤è¯†ï¼Œä¸­ä»‹æœ‰åª’ä»‹
  - å¦‚`event`è‡ªå®šä¹‰äº‹ä»¶

> æœ€æ˜æ˜¾çš„å·®åˆ«å°±æ˜¯P/Oéœ€è¦æ‰‹åŠ¨è§¦å‘`emit`

```js
// ç»‘å®š
event.on('event-key', () => {
// äº‹ä»¶1
})
event.on('event-key', () => {
// äº‹ä»¶2
})
// è§¦å‘æ‰§è¡Œã€åŒºåˆ«âœ”ã€‘
event.emit('event-key')
```
[å‘å¸ƒè®¢é˜…VSè§‚å¯Ÿè€…](./assets/drowio/compare.drawio ':include :type=code')


### åœºæ™¯
#### è‡ªå®šä¹‰äº‹ä»¶
   
#### postMessage


