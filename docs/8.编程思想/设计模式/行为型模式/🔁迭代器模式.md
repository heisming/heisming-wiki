# ğŸ”è¿­ä»£å™¨æ¨¡å¼

- é¡ºåºè®¿é—®æœ‰åºç»“æ„ï¼ˆå¦‚æ•°ç»„ã€NodeListï¼‰
- ä¸çŸ¥é“æ•°æ®çš„é•¿åº¦å’Œå†…éƒ¨ç»“æ„
- é«˜å†…èšã€ä½è€¦åˆ

> ä¸€å¥è¯ï¼šè®©ä½ èƒ½åœ¨ä¸æš´éœ²é›†åˆåº•å±‚è¡¨ç°å½¢å¼ï¼ˆåˆ—è¡¨ã€æ ˆå’Œæ ‘ç­‰ï¼‰çš„æƒ…å†µä¸‹éå†é›†åˆä¸­æ‰€æœ‰çš„å…ƒç´ 

**æ™®é€šforå¾ªç¯ä¸æ˜¯è¿­ä»£å™¨, ä¸ç¬¦åˆé«˜å†…èšä½è€¦åˆ(éœ€è¦çŸ¥é“å¯¹è±¡çš„å†…éƒ¨ç»“æ„).**
```js
const arr = [10, 20, 30]
// éœ€è¦çŸ¥é“æ•°ç»„çš„é•¿åº¦
const length = arr.length
for (let i = 0; i < length; i++) {
  // éœ€è¦é€šè¿‡arr[i]çš„å½¢å¼æ¥å¾—åˆ°item
  console.log(arr[i])
}
```


**ç®€æ˜“è¿­ä»£å™¨**
```js
// ä¸çŸ¥é“é•¿åº¦
// ä¸çŸ¥é“å¦‚ä½•è·å–item
const pList = document.querySelectorAll('p')
pList.forEach(p => console.log(p))
```

UML

```ts
class DataIterator {
  private data: number[]
  private index = 0
  constructor(container: DataContainer) {
    this.data = container.data
  }
  next(): number | null {
    if (this.hasNext()) {
      return this.data[this.index++]
    }
    return null
  }
  hasNext(): boolean {
    if (this.index >= this.data.length) return false
    return true
  }
}

class DataContainer {
  data: number[] = [10, 20, 30]
  // è·å–è¿­ä»£å™¨
  getIterator() { return new DataIterator(this)  }
}

const container = new DataContainer()
const iterator = container.getIterator()
while(iterator.hasNext()) {
  const num = iterator.next();
  console.log(num)
}
```

æ˜¯å¦ç¬¦åˆè®¾è®¡åŸåˆ™ï¼Ÿ
å¼€æ”¾å°é—­åŸåˆ™ï¼ˆå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ï¼‰
- ä½¿ç”¨è€…å’Œç›®æ ‡æ•°æ®åˆ†ç¦»ï¼Œè§£è€¦
- ç›®æ ‡æ•°æ®è‡ªè¡Œæ§åˆ¶å†…éƒ¨è¿­ä»£é€»è¾‘
- ä½¿ç”¨è€…ä¸å…³å¿ƒç›®æ ‡æ•°æ®çš„å†…éƒ¨ç»“æ„

## åœºæ™¯
JSæœ‰åºå¯¹è±¡ï¼Œéƒ½å†…ç½®è¿­ä»£å™¨
- å­—ç¬¦ä¸² 
  - `const str = 'abc' =æ‰§è¡Œ=> str[0] str[1] str[2]`
- æ•°ç»„
- NodeListç­‰DOMé›†åˆ
  - `document.querySelectorAll('p')`
- Map
- Set
- arguments
  - `function fn() { console.log(arguments) } fn(1, 2, 3, 4)`

> â—å¯¹è±¡objectä¸æ˜¯æœ‰åºç»“æ„
```js
const obj = {}
obj[0] = 'a'
obj[1] = 'b'
// { 0: 'a', 1: 'b'}
Object.keys(obj) // ['0', '1']
// å†åè¿‡æ¥
const obj1 = {}
obj1[1] = 'b'
obj1[0] = 'a'
// { 0: 'a', 1: 'b'}
Object.keys(obj1) // ['0', '1']
```
> ç»“è®ºï¼šç»™Objèµ‹å€¼æ˜¯ä¸èƒ½ä¿è¯æœ‰åºçš„


### Symbol.iterator(jså†…ç½®è¿­ä»£å™¨)
æ¯ä¸ªæœ‰åºå¯¹è±¡ï¼Œéƒ½å†…ç½®äº†`Symbol.iterator`å±æ€§ï¼Œå±æ€§å€¼æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚
æ‰§è¡Œè¯¥å‡½æ•°å°†è¿”å›iteratorè¿­ä»£å™¨ï¼Œæœ‰`next()`æ–¹æ³•ï¼Œæ‰§è¡Œè¿”å›`{ value, done }`ç»“æ„ã€‚
```js
// æ‹¿æ•°ç»„è·ç¦»ï¼Œå…¶å®ƒç±»å‹ä¹Ÿä¸€æ ·
const arr = [10, 20, 30]
const iterator = arr[Symbol.iterator]()
iterator // Array Iterator {}
iterator.next() // {value: 10, done: false}
iterator.next() // {value: 20, done: false}
iterator.next() // {value: 30, done: false}
iterator.next() // {value: undefined, done: true}
```
å¦å¤–ï¼Œæœ‰äº›å¯¹è±¡çš„APIä¹Ÿä¼šç”Ÿæˆæœ‰åºå¯¹è±¡
```js
const map = new Map([ ['k1', 'v1'], ['k2', 'v2'] ])
const mapIterator = map[Symbol.iterator]()
// or
const values = map.values() // å¹¶ä¸æ˜¯Array
const valuesIterator = values[Symbol.iterator]()
// mapè¿˜æœ‰keys entriesç­‰æ–¹æ³•å¯ä»¥è·å–å†…ç½®çš„è¿­ä»£å™¨
```

### è‡ªå®šä¹‰è¿­ä»£å™¨
```ts
interface IteratorRes {
  value: number | undefined
  done: boolean
}

class CustomIterator {
  private length = 3
  private index = 0

  next(): IteratorRes {
    this.index++
    if (this.index <= this.length) {
      return { value: this.index, done: false}
    }
    return { value: undefined, done: true}
  }
  [Symbol.iterator]() {
    return this
  }
}

const iterator = new CustomIterator()
// or
const it = iterator[Symbol.iterator]()
console.log(iterator.next())
console.log(it.next())
```

### æœ‰åºç»“æ„(è¿­ä»£å™¨)çš„ä½œç”¨
for...of
> â¤æ‰€æœ‰æœ‰åºç»“æ„(è¿­ä»£å™¨)ï¼Œéƒ½æ”¯æŒfor...ofè¯­æ³•

#### æ•°ç»„æ“ä½œï¼šè§£æ„/æ‰©å±•æ“ä½œç¬¦ã€Array.from
```js
const someDomList = document.querySelectorAll('p')
// æ•°ç»„è§£æ„
const [node1, node2] = someDomList
// or
const set = new Set([100, 200])
const [n1, n2] = set

// æ‰©å±•æ“ä½œç¬¦
const arr = [...someDomList]
const newArr = [...set]
const newDomList = [...someDomList]
// Array.from()
const arr = Array.from(someDomList) // [p, p, p]
```
#### åˆ›å»ºMapå’ŒSet
```js
// ä¼ å…¥æœ‰åºç»“æ„
const map = new Map([ ['k1', 'v1'], ['k2', 'v2'] ])
const set = new Set(someDomList)
```
#### Promise.allå’ŒPromise.race
```js
// ä¼ å…¥æœ‰åºç»“æ„
Promise.all([promise1, promise2, promise3])
Promise.race([promise1, promise2, promise3])
```

#### yield*æ“ä½œç¬¦
Generatorç”Ÿæˆå™¨
1. åŸºæœ¬ä½¿ç”¨
```js
function* genNums() {
  yield 10
  yield 20
  yield '30'
}
const numsIterator = genNums() // è¿”å›è¿­ä»£å™¨ï¼ŒåŒ any[Symbol.Iterator]
console.log(numsIterator.next())
console.log(numsIterator.next())
console.log(numsIterator.next())
// for...of
for (let n of numsIterator) {
  console.log(n)
}
// è§£æ„
const [n1, n2] = numsIterator;
```
2. yield*è¯­æ³•
```js
function* genNums(arr) {
  yield* [10, 20, '30'] // å¯ä»¥ä½¿ç”¨æœ‰åºç»“æ„ï¼Œå·²ç»å®ç°äº†[Symbol.Iterator]
  // or
  for(let i = 0; i < arr.length; i++) {
    yield arr[i]
  }
}
const numsIterator = genNums()
for (let n of numsIterator) {
  console.log(n)
}
```
```js
class CustomIterator {
  private data: number[]
  constructor() {
    this.data = [100, 200, 300]
  }
  * [Symbol.iterator]() {
    yield* this.data
  }
}
const iterator = new CustomIterator()
for(let n of iterator) {
  console.log(n)
}
```

3. yieldéå†DOMæ ‘
> æ·±åº¦ä¼˜å…ˆéå†
```html
<body>
  <p>demo</p>
  <div id="container">
    <p><b>hello </b><em>world</em></p>
    <p><img src="" /></p>
  </div>
</body>
<script>
  function* traverse(elementList: Element[]): any {
    for (const elem of elementList) {
      yield elem
      const children = Array.from(elem.children)
      if (children.length) {
        yield* traverse(children) // ç”Ÿæˆè¿­ä»£å™¨
      }
    }
  }
  const container = document.getElementById('container')
  if (container) {
    for(let node of traverse(container)) {
      console.log(node)
    }
  }
</script>
```
> Generatorå’Œè¿­ä»£å™¨çš„å…³ç³»ï¼šå³é¸¡å’Œè›‹çš„å…³ç³»
> ç®€å•çš„forå¾ªç¯ä¸æ—¶è¿­ä»£å™¨ï¼Œè¿­ä»£å™¨æ˜¯è§£å†³forå¾ªç¯çš„é—®é¢˜