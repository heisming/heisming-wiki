# æ±Ÿè¥¿å¾®æ ¡é€š

## å·¥ç¨‹åŒ–æ­å»º
`package.json`
```json
{
  "name": "admin",
  "private": true,
  "version": "0.0.0",
  "scripts": {
    "postinstall": "husky install",
    "start": "vite --host 0.0.0.0",
    "build": "vite build",
    "build:staging": "vite build --mode staging",
    "preview": "vite preview"
  },
  "dependencies": {
    "@element-plus/icons-vue": "^1.1.4",
    "@sentry/tracing": "^6.19.7",
    "@sentry/vue": "^6.19.7",
    "@vueuse/core": "^8.2.6",
    "ali-oss": "^6.17.1",
    "axios": "^0.26.1",
    "dayjs": "^1.11.1",
    "element-plus": "^2.2.5",
    "html2canvas": "^1.4.1",
    "jsoneditor": "^9.7.4",
    "marked": "^4.0.14",
    "md5": "^2.3.0",
    "normalize.css": "^8.0.1",// Normalize.cssæ˜¯ä¸€ç§CSS resetçš„æ›¿ä»£æ–¹æ¡ˆã€‚https://jerryzou.com/posts/aboutNormalizeCss/
    "nprogress": "^0.2.0",// NProgressæ˜¯é¡µé¢è·³è½¬æ˜¯å‡ºç°åœ¨æµè§ˆå™¨é¡¶éƒ¨çš„è¿›åº¦æ¡ https://ricostacruz.com/nprogress/ https://www.jianshu.com/p/346c05d4d9d8
    "path-browserify": "^1.0.1",// æ•´åˆ vite åï¼Œpathæ¨¡å—ä¼šæŠ¥é”™ï¼ŒåŸå› æ˜¯ vite æºç ä¸­è®¾å®šäº†ä¸å…è®¸åœ¨å®¢æˆ·ç«¯ä»£ç ä¸­è®¿é—®å†…ç½®æ¨¡å—ä»£ç ï¼Œä½¿ç”¨ path-browserify ä»£æ›¿ path æ¨¡å— https://juejin.cn/post/7130090422651191333
    "path-to-regexp": "^6.2.0", // è¯¥æ–¹æ³•çš„ä½œç”¨æ˜¯æŠŠå­—ç¬¦ä¸²è½¬ä¸ºæ­£åˆ™è¡¨è¾¾å¼ã€‚ä¸€ä¸ªå¯¹URLè¿›è¡Œè§£æçš„æ¨¡å—ï¼Œæ”¯æŒæ­£åˆ™è¡¨è¾¾å¼éªŒè¯ã€åŒ¹é…ã€åå‘è§£æï¼Œå¯ç”¨äºå¢åŠ  koa æ¡†æ¶å¯¹äº koa-router å¯¹ path çš„è§£æå·¥ä½œã€‚
    "pinia": "^2.0.13",
    "qrcode-vue3": "1.4.15",
    "socket.io-client": "^4.5.0",
    "sortablejs": "^1.15.0",
    "vue": "^3.2.25",
    "vue-qr": "^4.0.6",
    "vue-router": "^4.0.14",
    "xlsx": "^0.18.5"
  },
  "devDependencies": {
    "@types/ali-oss": "^6.16.3",
    "@types/jsoneditor": "^9.5.1",
    "@types/marked": "^4.0.3",
    "@types/md5": "^2.3.2",
    "@types/nprogress": "^0.2.0",
    "@types/path-browserify": "^1.0.0",
    "@types/path-to-regexp": "^1.7.0",
    "@types/sortablejs": "^1.10.7",
    "@typescript-eslint/eslint-plugin": "^5.19.0",
    "@typescript-eslint/parser": "^5.19.0",
    "@vitejs/plugin-vue": "^2.3.1", // æ¡†æ¶è‡ªå¸¦
    "cross-env": "^7.0.3", // å°±æ˜¯é’ˆå¯¹ç›¸åŒçš„è¯­å¥å’Œå‘½ä»¤ï¼Œæˆ‘ä»¬å¸Œæœ›è¿™æ¡è¯­å¥èƒ½å¤ŸåŒæ—¶åœ¨ Windows å’Œ Linux ä¸Šä½¿ç”¨ã€‚ https://juejin.cn/post/7006650325931130916
    "eslint": "^8.13.0",
    "eslint-config-airbnb-base": "^15.0.0",
    "eslint-config-airbnb-typescript": "^17.0.0",
    "eslint-config-prettier": "^8.5.0",
    "eslint-import-resolver-typescript": "^2.7.1",
    "eslint-plugin-import": "^2.26.0",
    "eslint-plugin-prettier": "^4.0.0",
    "eslint-plugin-vue": "^8.6.0",
    "husky": "^7.0.4",
    "lint-staged": "^12.3.8",
    "prettier": "^2.6.2",
    "rollup-plugin-external-globals": "^0.6.1",
    "sass": "^1.50.0",
    "typescript": "^4.5.4",
    "vite": "^2.9.2",
    "vite-plugin-pwa": "^0.11.13",
    "vite-plugin-svg-icons": "^2.0.1", // å½“ä½ ä½¿ç”¨è¯¥æ’ä»¶çš„æ—¶å€™ï¼ŒæŒ‡å®šå¥½å­˜æ”¾svgçš„æ–‡ä»¶å¤¹ã€‚å†æŒ‰ç…§æŒ‡å®šçš„æ–¹å¼å»è®¿é—®svgå›¾ç‰‡ã€‚å°±å¯ä»¥å†ä¸äº§ç”Ÿhttpè¯·æ±‚çš„æƒ…å†µä¸‹æ¸²æŸ“å‡ºsvgå›¾ç‰‡ã€‚// https://www.kuxiaoxin.com/archives/66
    "vue-tsc": "^0.29.8",
    "workbox-window": "^6.5.3"
  }
}
```
### åˆ†æ
æŠ€æœ¯æ ˆ
- ç¼–ç¨‹è¯­è¨€ï¼š typescript
- æ„å»ºå·¥å…·ï¼švite
- è¯­è¨€æ¡†æ¶ï¼švue3
- è·¯ç”±ç®¡ç†ï¼švue-router
- çŠ¶æ€ç®¡ç†ï¼špinia
- UIæ¡†æ¶ï¼šelement-plus
- CSSé¢„ç¼–è¯‘ï¼šscss
- ä»£ç è§„èŒƒï¼šprettier&eslint
- æäº¤è§„èŒƒï¼šhusky&lint-staged
<!-- - æ¡Œé¢åº”ç”¨ï¼šelectron -->

### ä»å¤´å¼€å§‹

#### Vite
node 14.18+ or 16+
```bash
npm create vite@latest
yarn create vite
pnpm create vite

# ç»“æœ
âœ” Project name: â€¦ project
âœ” Select a framework: â€º vue
âœ” Select a variant: â€º vue-ts

Scaffolding project in /home/liming/code/temp/project...

Done. Now run:

  cd project
  pnpm install
  pnpm run dev

--------------------------------------------------------------------------------
~/code/temp Â»
```

æ‰“å¼€æ–‡ä»¶å¤¹ä¼šå‘ç°
![](assets/images/vite-start.png)


æ­¤æ—¶çš„`package.json`æ–‡ä»¶å¦‚ä¸‹:
```json
{
  "name": "project",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vue-tsc --noEmit && vite build",
    "preview": "vite preview"
  },
  "dependencies": {
    "vue": "^3.2.37"
  },
  "devDependencies": {
    "@vitejs/plugin-vue": "^3.0.3",
    "typescript": "^4.6.4",
    "vite": "^3.0.7",
    "vue-tsc": "^0.39.5"
  }
}
```

å†æ ¹ç›®å½•å¢åŠ ä¸€ä¸ª`.nvmrc`æ–‡ä»¶æ¥æ§åˆ¶nodeç‰ˆæœ¬
```
16.14.0
```
![](assets/images/nvmrc.png)

`.npmrc`
```
home="https://npmmirror.com"
registry="https://registry.npmmirror.com/"

sass_binary_site="https://npmmirror.com/mirrors/node-sass/"
canvas_binary_host_mirror="https://npmmirror.com/mirrors/node-canvas-prebuilt/"
phantomjs_cdnurl="https://npmmirror.com/dist/phantomjs/"
electron_mirror="https://npmmirror.com/mirrors/electron/"
sqlite3_binary_host_mirror="http://npmmirror.com/mirrors/"
profiler_binary_host_mirror="https://npmmirror.com/mirrors/node-inspector/"
chromedriver_cdnurl="http://npmmirror.com/mirrors/chromedriver/"
operadriver_cdnurl="http://npmmirror.com/mirrors/operadriver/"
electron_builder_binaries_mirror="http://npmmirror.com/mirrors/electron-builder-binaries/"
```

ç¯å¢ƒå˜é‡ä¸æ¨¡å¼
[å®˜ç½‘](https://vitejs.cn/guide/env-and-mode.html)
æ ¹ç›®å½•è¿˜éœ€è¦å¢åŠ Vite
`.env.development`
```
NODE_ENV = 'development'
VITE_BASE_API = 'http://xxx.xxx.xxx/xxx'
```
`.env.production`
```
NODE_ENV = 'production'
VITE_BASE_API = 'http://xxx.xxx.xxx/xxx'
```
`.env.staging`
```
NODE_ENV = 'staging'
VITE_BASE_API = 'http://xxx.xxx.xxx/xxx'
```

é…ç½®vite
> é…ç½®å‰éœ€è¦å¼•å…¥**path-browserify**åŒ…ï¼Œå› ä¸ºæ•´åˆ vite åï¼Œpathæ¨¡å—ä¼šæŠ¥é”™ï¼ŒåŸå› æ˜¯ vite æºç ä¸­è®¾å®šäº†ä¸å…è®¸åœ¨å®¢æˆ·ç«¯ä»£ç ä¸­è®¿é—®å†…ç½®æ¨¡å—ä»£ç ï¼Œæ‰€ä»¥ä½¿ç”¨ path-browserify ä»£æ›¿ path æ¨¡å—
```bash
pnpm i --save(-S) path-browserify
pnpm i --save-dev(-D) @types/path-browserify
```

`vite.config.ts`æ–‡ä»¶
```ts
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
// æ‰¾ä¸åˆ°æ¨¡å—â€œpathâ€æˆ–å…¶ç›¸åº”çš„ç±»å‹å£°æ˜: pnpm i @types/node
// è¯·åœ¨tsconfig.jsonä¸‹compilerOptionså¢åŠ "paths": {"@/*": ["src/*"]},  "baseUrl": ".",
import { resolve } from 'path' 

// https://vitejs.dev/config/
export default defineConfig({
  // https://cn.vitejs.dev/config/shared-options.html#resolve-alias
  // å½“ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿè·¯å¾„çš„åˆ«åæ—¶ï¼Œè¯·å§‹ç»ˆä½¿ç”¨ç»å¯¹è·¯å¾„ã€‚ç›¸å¯¹è·¯å¾„çš„åˆ«åå€¼ä¼šåŸå°ä¸åŠ¨åœ°è¢«ä½¿ç”¨ï¼Œå› æ­¤æ— æ³•è¢«æ­£å¸¸è§£æã€‚
  resolve: {
    alias: {
      '@/': `${resolve(__dirname, 'src')}/`
    }
  },
  plugins: [vue()]
})
```
`tsconfig.json`æ–‡ä»¶
```json
{
  "compilerOptions": {
    "target": "ESNext",
    "useDefineForClassFields": true,
    "module": "ESNext",
    "moduleResolution": "Node",
    "strict": true,
    "jsx": "preserve",
    "sourceMap": true,
    "resolveJsonModule": true,
    "isolatedModules": true,
    "esModuleInterop": true,
    "lib": ["ESNext", "DOM"],
    "skipLibCheck": true,
    // æ–°å¢
    "baseUrl": ".",
    "paths": {
      "@/*": ["src/*"]
    }
  },
  "include": ["src/**/*.ts", "src/**/*.d.ts", "src/**/*.tsx", "src/**/*.vue"],
  "references": [{ "path": "./tsconfig.node.json" }]
}
```

css-reset
```bash
pnpm i --save normalize.css
```

å†å®‰è£…è¡¥å……å‡ ä¸ªå¸¸ç”¨çš„Vueç”Ÿæ€åº“
```bash
pnpm i --save @vueuse/core vue-router pinia 
```

pinia
åœ¨`src`ç›®å½•ä¸‹æ–°å»º`store`æ–‡ä»¶å¤¹ï¼Œå¹¶æ–°å»ºæ–‡ä»¶`user.ts`
```ts
import { useLocalStorage } from "@vueuse/core";
import { defineStore } from "pinia";

const useUserStore = defineStore('user', {
  state: () => ({
    token: useLocalStorage<string | null>('token', null)
  }),
  actions: {
    logout() {
      this.token = null;
    }
  }
})

export default useUserStore;
```

åœ¨`src`ç›®å½•ä¸‹æ–°å»º`views/dashboard/`æ–‡ä»¶å¤¹ï¼Œå¹¶æ–°å»ºæ–‡ä»¶`index.vue`
```vue
<template>
  <div>
    dashboard
  </div>
</template>
<script lang='ts' setup>
import { defineComponent, ref, reactive } from 'vue';
</script>
<script lang='ts'>
defineComponent({
  // è¿™é‡Œçš„nameå’Œè·¯ç”±çš„æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ
  name: 'DashboardView', 
});
</script>
<style lang='scss' scoped>
</style>
```
åœ¨`src`ç›®å½•ä¸‹æ–°å»º`views/login/`æ–‡ä»¶å¤¹ï¼Œå¹¶æ–°å»ºæ–‡ä»¶`index.vue`
```vue
<template>
  <div class="login-container">
    login
  </div>
</template>
<script lang='ts' setup>
import { defineComponent, ref, reactive } from 'vue';
</script>
<script lang='ts'>
defineComponent({
  name: 'LoginView', 
});
</script>
<style lang='scss' scoped>
.login-container {
  color: $blue;
  font-size: 20px;
}
</style>
```
åœ¨`src`ç›®å½•ä¸‹æ–°å»º`views/notFound/`æ–‡ä»¶å¤¹ï¼Œå¹¶æ–°å»ºæ–‡ä»¶`index.vue`
```vue
<template>
  <div>
    404
  </div>
</template>
<script lang='ts' setup>
import { defineComponent, ref, reactive } from 'vue';
</script>
<script lang='ts'>
defineComponent({
  name: 'NotFoundView', 
});
</script>
<style lang='scss' scoped>
</style>
```

åœ¨`src`ç›®å½•ä¸‹æ–°å»º`views/log/`æ–‡ä»¶å¤¹ï¼Œå¹¶æ–°å»ºæ–‡ä»¶`index.vue`
```vue
<template>
  <div>
    SystemLogView
  </div>
</template>
<script lang='ts' setup>
import { defineComponent, ref, reactive } from 'vue';
</script>
<script lang='ts'>
defineComponent({
  name: 'SystemLogView', 
});
</script>
<style lang='scss' scoped>
</style>
```

router
åœ¨`src`ç›®å½•ä¸‹æ–°å»º`router/route`æ–‡ä»¶å¤¹ï¼Œå¹¶æ–°å»ºæ–‡ä»¶`router/index.ts`å’Œ`routes/log.ts`
log.ts
```ts
import { RouteRecordRaw } from "vue-router";
const LogRoutes: Array<RouteRecordRaw> = [
  {
    path: '/log',
    name: 'Log',
    redirect: '/log/system',
    meta: { title: 'æ—¥å¿—ç®¡ç†', icon: 'vue' },
    // åµŒå¥—è·¯ç”±çš„çˆ¶è·¯ç”±æ ·å¼(æœªå®šä¹‰)
    // component: Layout,
    children: [
      {
        path: '/log/system',
        name: 'SystemLogView',
        meta: { title: 'ç³»ç»Ÿæ—¥å¿—', cache: true },
        component: () => import('@/views/log/index.vue')
      }
    ]
  }
]
export default LogRoutes;
```

index.ts
```ts
import { createRouter, createWebHashHistory, RouteRecordRaw } from "vue-router"
import logRoutes from './routes/log'

export const routes: Array<RouteRecordRaw> = [
  {
    path: '/',
    name: 'App',
    redirect: '/dashboard',
    children: [
      {
        path: '/dashboard',
        meta: { title: 'é¦–é¡µ', icon: "vue", affix: true, cache: true },
        name: 'DashboardView',
        component: () => import('@/views/dashboard/index.vue')
      }
    ]
  },
  ...logRoutes,
  {
    path: '/login',
    name: 'LoginView',
    meta: { title: 'ç”¨æˆ·ç™»å½•', icon: "vue", hidden: true },
    component: () => import('@/views/login/index.vue')
  },
  {
    // TODO è¿™æ˜¯ä¸€ç§ä»€ä¹ˆåŒ¹é…æ¨¡å¼
    path: '/:pathMatch(.*)*',
    name: 'NotFount',
    redirect: '/404'
  }
]

const router = createRouter({
  // é€‰æ‹©hashæ¨¡å¼è·¯ç”±
  history: createWebHashHistory(),
  routes,
})

export default router;
```
å½“ç„¶è¿˜éœ€è¦ä¸€ä¸ªè·¯ç”±å®ˆå«`guard.ts`
```ts
import { NavigationGuardNext, RouteLocationNormalized } from 'vue-router';
import useUserStore from '@/store/user';
import router from './index';

// ç™½åå•è·¯ç”±
const whiteList = ['/login']

router.beforeEach((to: RouteLocationNormalized, from: RouteLocationNormalized, next: NavigationGuardNext) => {
  const userStore = useUserStore()
  // æ»¡è¶³æ¡ä»¶
  if(whiteList.includes(to.path)) return next();
  // ä¸æ»¡è¶³æ¡ä»¶
  if(!userStore.token) return next(`/login?redirect=${to.path}`);
  return next();
})
```

ç½‘ç»œè¯·æ±‚ç›¸å…³ï¼š

```bash
pnpm i --save axios
```
åœ¨`src`ç›®å½•ä¸‹æ–°å»º`utils`æ–‡ä»¶å¤¹ï¼Œå¹¶æ–°å»ºæ–‡ä»¶`request.ts`
```ts
import router from '@/router';
import useUserStore from '@/store/user';
import axios, { AxiosError, AxiosInstance, AxiosRequestConfig, AxiosResponse } from 'axios';

class VAxios {
  private axiosInstance: AxiosInstance;

  private static VAxiosInstance: VAxios;

  private constructor(config: AxiosRequestConfig) {
    this.axiosInstance = axios.create(config);
    this.setRequestInterceptors();
    this.setResponseInterceptors();
  }

  /** åˆ›å»º axios å®ä¾‹ */
  public static getInstance() {
    if (!this.VAxiosInstance) {
      this.VAxiosInstance = new this({
        baseURL: import.meta.env.VITE_BASE_API as string,
        timeout: 120000,
        headers: {
          'Content-Type': 'application/json; charset=utf-8',
          Accept: '*/*',
        },
      });
    }

    return this.VAxiosInstance;
  }

  /** è®¾ç½®è¯·æ±‚æ‹¦æˆªå™¨ */
  private setRequestInterceptors() {
    // é…ç½® && é”™è¯¯å¤„ç†
    this.axiosInstance.interceptors.request.use(
      (config: AxiosRequestConfig) => {
        config.headers!.Authorization = useUserStore().token as string;

        return config;
      },
      error => Promise.reject(error)
    );
  }

  /** è®¾ç½®å“åº”æ‹¦æˆªå™¨ */
  private setResponseInterceptors() {
    // é…ç½® && é”™è¯¯å¤„ç†
    this.axiosInstance.interceptors.response.use(
      (response: AxiosResponse) => response.data,

      (error: AxiosError | Error) => {
        if (!axios.isAxiosError(error)) return Promise.reject(error.message);
        if (!error.response) return Promise.reject(error.message);

        switch (error.response.status) {
          case 401:
            useUserStore().logout();
            return Promise.reject(new Error('è¯·ç™»é™†åæ“ä½œ'));
          case 403:
            router.replace('/403');
            return Promise.reject(new Error('æƒé™ä¸è¶³'));
          case 404:
            return Promise.reject(new Error('è¯·æ±‚åœ°å€ä¸å­˜åœ¨'));
          case 500:
            return Promise.reject(new Error('æœåŠ¡å™¨å†…éƒ¨é”™è¯¯'));
          case 502:
            return Promise.reject(new Error('æœåŠ¡å™¨ç½‘ç»œé”™è¯¯'));
          default:
            return Promise.reject(
              typeof error.response.data === 'string' || error.response.data instanceof String
                ? error.response.data
                : error.response.data?.message ?? error.response.data?.error
            );
        }
      }
    );
  }

  /** è¯·æ±‚ */
  async request<T = any>(config: AxiosRequestConfig): Promise<T> {
    return this.axiosInstance.request(config);
  }

  /**
   * post
   * @param url è¯·æ±‚åœ°å€
   * @param data bodyå‚æ•°
   * @param config axios é…ç½®
   */
  async post<T = any>(url: string, data?: any, config?: AxiosRequestConfig): Promise<T> {
    return this.axiosInstance.post(url, data, config);
  }

  /**
   * delete
   * @param url è¯·æ±‚åœ°å€
   * @param config axios é…ç½®
   */
  async delete<T = any>(url: string, config?: AxiosRequestConfig): Promise<T> {
    return this.axiosInstance.delete(url, config);
  }

  /**
   * put
   * @param url è¯·æ±‚åœ°å€
   * @param data bodyå‚æ•°
   * @param config axios é…ç½®
   */
  async put<T = any>(url: string, data?: any, config?: AxiosRequestConfig): Promise<T> {
    return this.axiosInstance.put(url, data, config);
  }

  /**
   * patch
   * @param url è¯·æ±‚åœ°å€
   * @param data bodyå‚æ•°
   * @param config axios é…ç½®
   */
  async patch<T = any>(url: string, data?: any, config?: AxiosRequestConfig): Promise<T> {
    return this.axiosInstance.patch(url, data, config);
  }

  /**
   * get
   * @param url è¯·æ±‚åœ°å€
   * @param config axios é…ç½®
   */
  async get<T = any>(url: string, config?: AxiosRequestConfig): Promise<T> {
    return this.axiosInstance.get(url, config);
  }
}

export default VAxios.getInstance();
```

UIæ¡†æ¶ï¼š
[å®˜ç½‘](https://element-plus.org/zh-CN/guide/i18n.html)
```bash
pnpm i --save element-plus @element-plus/icons-vue
```

MD5åŠ å¯†:
```bash
pnpm i --save md5
pnpm i --save-dev @types/md5
```

CSSé¢„å¤„ç†å™¨(viteå†…ç½®æ”¯æŒï¼‰ï¼š
[å®˜ç½‘](https://vitejs.cn/guide/features.html#css-pre-processors)
```bash
pnpm i --save-dev sass
```
åœ¨`src`ç›®å½•ä¸‹æ–°å»º`styles`æ–‡ä»¶å¤¹ï¼Œå¹¶æ–°å»ºæ–‡ä»¶`index.scss`
```scss
$blue: #abcdef;
$menuText: #bfc;
// TODO
:export {
  menuText: $menuText
}
```

ä½¿ç”¨æ’ä»¶è®©è®¿é—®svgä¸ç”¨äº§ç”Ÿhttpè¯·æ±‚
[github](https://github.com/vbenjs/vite-plugin-svg-icons/blob/main/README.zh_CN.md)
```bash 
pnpm i --save-dev vite-plugin-svg-icons
```
ä¿®æ”¹`vite.config.ts`ä¸­çš„æ’ä»¶pluginsé…ç½®
```ts
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
// æ‰¾ä¸åˆ°æ¨¡å—â€œpathâ€æˆ–å…¶ç›¸åº”çš„ç±»å‹å£°æ˜: pnpm i @types/node
// è¯·åœ¨tsconfig.jsonä¸‹compilerOptionså¢åŠ "paths": {"@/*": ["src/*"]},  "baseUrl": ".",
import { resolve } from 'path' 

import { createSvgIconsPlugin } from 'vite-plugin-svg-icons'

// https://vitejs.dev/config/
export default defineConfig({
  // https://cn.vitejs.dev/config/shared-options.html#resolve-alias
  // å½“ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿè·¯å¾„çš„åˆ«åæ—¶ï¼Œè¯·å§‹ç»ˆä½¿ç”¨ç»å¯¹è·¯å¾„ã€‚ç›¸å¯¹è·¯å¾„çš„åˆ«åå€¼ä¼šåŸå°ä¸åŠ¨åœ°è¢«ä½¿ç”¨ï¼Œå› æ­¤æ— æ³•è¢«æ­£å¸¸è§£æã€‚
  resolve: {
    alias: {
      '@/': `${resolve(__dirname, 'src')}/`
    }
  },
  plugins: [
    vue(),
    createSvgIconsPlugin({
      // æŒ‡å®šè¦ç¼“å­˜çš„å›¾æ ‡æ–‡ä»¶å¤¹
      iconDirs: [resolve(process.cwd(), 'src/assets/svg')],
      // æ‰§è¡Œ icon name çš„æ ¼å¼
      symbolId: 'icon-[dir]-[name]',
    })
  ]
})
```

åœ¨`src/component/`ä¸‹æ–°å»ºæ–‡ä»¶`SvgIcon.vue`
```vue
<template>
  <svg :class="svgClass" :style="style">
    <use :xlink:href="iconName" />
  </svg>
</template>

<script lang="ts" setup>
import { computed, toRefs } from 'vue';

const props = defineProps<{
  name?: string;
  style?: { [key: string]: string };
}>();

const { style } = toRefs(props);
const iconName = computed(() => `#icon-${props.name}`);
const svgClass = computed(() => (props.name ? `svg-icon icon-${props.name}` : 'svg-icon'));
</script>

<style lang="scss" scoped>
.svg-icon {
  fill: currentColor;
  vertical-align: middle;
  width: 1em;
  height: 1em;
}
</style>
```

å°†å„ä¸ªæ¨¡å—æ·»åŠ è‡³`main.ts`ä¸­
src/App.vue
```vue
<template>
  <!-- çˆ¶çº§è·¯ç”± -->
  <router-view></router-view>
</template>

<script setup lang="ts"></script>

<style scoped></style>
```

main.ts
```ts
import { createApp } from 'vue'
// import './style.css'
import router from '@/router'
import SvgIcon from '@/components/SvgIcon.vue'
import ElementPlus  from 'element-plus'
// TODO å¯ä»¥ä¸è¿™æ ·å¼•å…¥å—ï¼Ÿ
import 'element-plus/dist/index.css'
import 'normalize.css'
// è¿™æ˜¯è™šæ‹Ÿæ¨¡å—çš„å¼•å…¥æ–¹å¼ï¼Œç”¨äºç»™è„šæ‰‹æ¶æ’ä»¶åœ¨æ‰“åŒ…å’Œå¼€å‘æ—¶åšç›¸åº”çš„å¤„ç†ã€‚Vite å’Œ Rollup ä¸­éƒ½çº¦å®šä»¥ virtual: ä½œä¸ºè™šæ‹Ÿæ¨¡å—çš„å‰ç¼€ï¼š
import 'virtual:svg-icons-register' 
import { createPinia } from 'pinia'
// å›½é™…åŒ– 
import ElementPlusLocaleZhCN from 'element-plus/es/locale/lang/zh-cn'
import App from './App.vue'
import '@/router/guard'

const app = createApp(App)
// æ³¨æ„å¼•ç”¨é¡ºåº
app.use(createPinia())
app.use(router)
app.use(ElementPlus, { locale: ElementPlusLocaleZhCN })
// å…¨å±€ç»„ä»¶
app.component('SvgIcon', SvgIcon)

app.mount('#app')
```
å“ï¼ŸSCSSæ ·å¼æ€ä¹ˆæ²¡å¼•å…¥å‘¢ï¼Ÿ
`vite.config.ts`
```ts
// https://vitejs.dev/config/
export default defineConfig({
  // https://cn.vitejs.dev/config/shared-options.html#resolve-alias
  // å½“ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿè·¯å¾„çš„åˆ«åæ—¶ï¼Œè¯·å§‹ç»ˆä½¿ç”¨ç»å¯¹è·¯å¾„ã€‚ç›¸å¯¹è·¯å¾„çš„åˆ«åå€¼ä¼šåŸå°ä¸åŠ¨åœ°è¢«ä½¿ç”¨ï¼Œå› æ­¤æ— æ³•è¢«æ­£å¸¸è§£æã€‚
  resolve: {
    alias: {
      '@/': `${resolve(__dirname, 'src')}/`
    }
  },
  plugins: [
    vue(),
    createSvgIconsPlugin({
      // æŒ‡å®šè¦ç¼“å­˜çš„å›¾æ ‡æ–‡ä»¶å¤¹
      iconDirs: [resolve(process.cwd(), 'src/assets/svg')],
      // æ‰§è¡Œ icon name çš„æ ¼å¼
      symbolId: 'icon-[dir]-[name]',
    })
  ],
  // å¼•å…¥index.scss
  css: {
    preprocessorOptions: {
      scss: {
        additionalData: `@import "./src/styles/index.scss";`,
      }
    }
  }
})
```

æ­¤æ—¶è¿è¡Œ`pnpm start(dev)`å‘ç°æŠ¥é”™äº†
```bash
failed to load config from /home/liming/code/temp/project/vite.config.ts
error when starting dev server:
Error [ERR_MODULE_NOT_FOUND]: Cannot find package 'fast-glob' imported from /home/liming/code/temp/project/node_modules/.pnpm/vite-plugin-svg-icons@2.0.1_vite@3.0.9/node_modules/vite-plugin-svg-icons/dist/index.mjs
```
äºæ˜¯å®‰è£…å®ƒå°±å¯ä»¥äº†
```bash
pnpm i -D fast-glob
```

## å¢åŠ å¼€å‘è§„èŒƒ
[æ˜é‡‘](https://juejin.cn/post/6909788084666105864)

å…ˆé€šè¿‡husky+eslintå®Œæˆä¸€ä¸ªæœ€ç®€å•çš„ä»£ç è§„èŒƒæ ¡éªŒï¼Œç„¶åé€æ­¥ä¼˜åŒ–ï¼Œæœ€åé€šè¿‡husky+eslint+lint-stage+commitlint+prettierå®ç°ä¸€ä¸ªå¼ºæœ‰åŠ›çš„é™åˆ¶ã€‚
æœ€åå†é…åˆcommitizen,é€šè¿‡commitlint-config-cz+cz-customizableå®ç°è‡ªå®šä¹‰çš„æäº¤æ¨¡æ¿å’Œé™åˆ¶è§„åˆ™æ¥å®ç°å›¢é˜Ÿæœ€ç»ˆçš„é¡¹ç›®æäº¤é™åˆ¶è§„çº¦ã€‚

- ä»£ç è§„èŒƒï¼šprettier&eslint
- æäº¤è§„èŒƒï¼šhusky&lint-staged

### eslint

```bash
$ pnpm i -D eslint
$ npx eslint --init # npm init @eslint/config

# é€‰æ‹©å¦‚ä¸‹
~/code/temp/second Â» npx eslint --init                                                                                                                           
You can also run this command directly using 'npm init @eslint/config'.
? How would you like to use ESLint? â€¦ 
  To check syntax only # åªæ£€æŸ¥è¯­æ³•
â–¸ To check syntax and find problems # æ£€æŸ¥è¯­æ³•å’ŒæŸ¥æ‰¾é”™è¯¯
  To check syntax, find problems, and enforce code style # æ£€æŸ¥è¯­æ³•ï¼ŒæŸ¥æ‰¾é”™è¯¯å¹¶ä¸”å¼ºåˆ¶ä¿æŒé£æ ¼

? What type of modules does your project use? â€¦  # é¡¹ç›®ä½¿ç”¨çš„æ¨¡å—è§„èŒƒ
â–¸ JavaScript modules (import/export)
  CommonJS (require/exports)
  None of these

? Which framework does your project use? â€¦ 
  React
â–¸ Vue.js
  None of these

? Does your project use TypeScript? â€£ No / Yes #YES

? Where does your code run? â€¦  (Press <space> to select, <a> to toggle all, <i> to invert selection) # å¯ä»¥å¤šé€‰
âœ” Browser # åªéœ€è¦é€‰æµè§ˆå™¨
âœ” Node 

? What format do you want your config file to be in? â€¦  # é…ç½®æ–‡ä»¶çš„ç±»å‹
â–¸ JavaScript 
  YAML
  JSON

The config that you've selected requires the following dependencies:

eslint-plugin-vue@latest @typescript-eslint/eslint-plugin@latest @typescript-eslint/parser@latest
? Would you like to install them now? â€£ No / Yes #YES

? Which package manager do you want to use? â€¦ 
  npm
  yarn
â–¸ pnpm

# å®‰è£…å®Œæˆå
devDependencies:
+ @typescript-eslint/eslint-plugin 5.36.1
+ @typescript-eslint/parser 5.36.1
+ eslint-plugin-vue 9.4.0
```
init å‘½ä»¤ä¼šè‡ªåŠ¨ç”Ÿæˆ`.eslintrc.cjs`
```js
module.exports = {
    // ç¯å¢ƒ
    "env": {
        "browser": true,
        "es2021": true
    },
    // æ‹“å±•
    "extends": [
        "eslint:recommended",
        "plugin:vue/vue3-essential",
        "plugin:@typescript-eslint/recommended"
    ],
    "overrides": [
    ],
    // è§£æå™¨ï¼Œæœ¬è§£æå™¨æ”¯æŒTs
    "parser": "@typescript-eslint/parser",
    // è§£æå™¨é…ç½®é€‰é¡¹
    "parserOptions": {
        // æŒ‡å®šesç‰ˆæœ¬
        "ecmaVersion": "latest",
        // ä»£ç æ”¯æŒes6ï¼Œä½¿ç”¨module
        "sourceType": "module"
    },
    // æ’ä»¶
    "plugins": [
        "vue",
        "@typescript-eslint"
    ],
    // è§„åˆ™
    "rules": {
    }
}
```

è¡¥å……
```bash
pnpm add eslint-config-airbnb-base eslint-config-airbnb-typescript eslint-plugin-import eslint-import-resolver-typescript -D
```
`.eslintrc.js`
```js
module.exports = {
  root: true,
  env: {
    node: true,
    browser: true,
    es6: true,
    'vue/setup-compiler-macros': true,
  },
  extends: ['plugin:vue/vue3-recommended', 'airbnb-base', 'airbnb-typescript/base', 'prettier'],
  parser: 'vue-eslint-parser',
  parserOptions: {
    ecmaVersion: 'latest',
    parser: '@typescript-eslint/parser',
    sourceType: 'module',
    project: ['./tsconfig.json'],
    extraFileExtensions: ['.vue'],
  },
  plugins: ['vue', '@typescript-eslint'],
  rules: {
    'no-console': process.env.NODE_ENV === 'production' ? ['error', { allow: ['warn', 'error'] }] : 'off',
    'no-debugger': process.env.NODE_ENV === 'production' ? 'error' : 'off',
    'no-param-reassign': ['error', { props: false }],
    'vue/script-setup-uses-vars': 'error',
    'vue/html-self-closing': [
      'error',
      {
        html: {
          void: 'always',
          normal: 'never',
          component: 'always',
        },
        svg: 'always',
        math: 'always',
      },
    ],
    'vue/multi-word-component-names': [
      'error',
      {
        ignores: ['index'],
      },
    ],
    'import/extensions': 'off',
    'import/no-extraneous-dependencies': ['error', { devDependencies: true }],
    'import/no-unresolved': 'off',
    'import/prefer-default-export': 'off',
    'import/no-cycle': 'off',
    'no-shadow': 'off',
    'no-restricted-syntax': 'off',
    '@typescript-eslint/no-use-before-define': ['error', { variables: false }],
  },
  settings: {
    'import/resolver': {
      node: {
        extensions: ['.js', '.jsx', '.ts', '.tsx'],
      },
      typescript: {
        alwaysTryTypes: true,
      },
    },
  },
};
```

### prettier
```bash 
pnpm i -D prettier eslint-config-prettier eslint-plugin-prettier
```

åœ¨`.eslintrc` ä¸­,extendä¸­æ·»åŠ  "prettier" è§£å†³ eslint å’Œ prettier çš„å†²çª
```js
   "extends": [
        "eslint:recommended",
        "plugin:vue/vue3-essential",
        "plugin:@typescript-eslint/recommended",
        "prettier" // å› ä¸ºeslint-config-prettieræ–°ç‰ˆæœ¬æ›´æ–°ä¹‹å,åªéœ€è¦å†™ä¸€ä¸ª "prettier" å³å¯,æ— éœ€å¤šè¨€æŒ‡ä»¤
    ],
```
ä¹Ÿå¯ä»¥é…ç½®å¿½ç•¥
`.eslintignore`
```
vite.config.ts
.eslintrc.js
```
æ ¹ç›®å½•åˆ›å»º`.prettierrc.js`
```js
// çœ‹è‡ªå·±æ€ä¹ˆé…ç½®äº†
module.exports = {
  singleQuote: true,// ä½¿ç”¨å•å¼•å·
  semi: true, // å¥æœ«ä½¿ç”¨åˆ†å·
  tabWidth: 2,// ç¼©è¿›é•¿åº¦
  useTabs: false, // ä½¿ç”¨ç©ºæ ¼ä»£æ›¿tabç¼©è¿›
  printWidth: 160, // å•è¡Œé•¿åº¦
  endOfLine: 'auto', // ç»“æŸè¡Œå½¢å¼
  bracketSpacing: true, // åœ¨å¯¹è±¡å‰åæ·»åŠ ç©ºæ ¼-eg: { foo: bar }
  jsxBracketSameLine: true, // å¤šå±æ€§htmlæ ‡ç­¾çš„â€˜>â€™æŠ˜è¡Œæ”¾ç½®
  arrowParens: 'avoid', // (x) => {} ç®­å¤´å‡½æ•°å‚æ•°åªæœ‰ä¸€ä¸ªæ—¶æ˜¯å¦è¦æœ‰å°æ‹¬å·ã€‚avoidï¼šçœç•¥æ‹¬å·
  eslintIntegration: true,
  htmlWhitespaceSensitivity: 'ignore', // å¯¹HTMLå…¨å±€ç©ºç™½ä¸æ•æ„Ÿ
  'editor.codeActionsOnSave': {
    'source.fixAll.eslint': true,
  },
};
```

gitè§„èŒƒ
> Git æœ‰å¾ˆå¤šçš„ hooks, è®©æˆ‘ä»¬åœ¨ä¸åŒçš„é˜¶æ®µ,å¯¹ä»£ç è¿›è¡Œä¸åŒçš„æ“ä½œ,æ§åˆ¶æäº¤åˆ°ä»“åº“çš„ä»£ç çš„è§„èŒƒæ€§,å’Œå‡†ç¡®æ€§, ä»¥ä¸‹åªæ˜¯å‡ ä¸ªå¸¸ç”¨çš„é’©å­
æäº¤çš„ä»£ç è§„èŒƒ
pre-commit
æè¿°: é€šè¿‡é’©å­å‡½æ•°,åˆ¤æ–­æäº¤çš„ä»£ç æ˜¯å¦ç¬¦åˆè§„èŒƒ

æäº¤çš„ä¿¡æ¯è§„èŒƒ
commit-msg
æè¿°: é€šè¿‡é’©å­å‡½æ•°,åˆ¤æ–­ commit ä¿¡æ¯æ˜¯å¦ç¬¦åˆè§„èŒƒ

æäº¤çš„ä»£ç å½±å“
pre-push
æè¿°: é€šè¿‡é’©å­,æ‰§è¡Œæµ‹è¯•,é¿å…å¯¹ä»¥å‰çš„å†…å®¹é€ æˆå½±å“

å·¥å…·
husky
ä¸ºæˆ‘ä»¬çš„é¡¹ç›®æ·»åŠ git hooks, æ“ä½œ git é’©å­çš„å·¥å…·ã€‚
```bash
$ pnpm i husky -D
```
> ç›®å‰æˆ‘æ‰€å®‰è£…çš„ç‰ˆæœ¬æ˜¯husky@7.0.4,ç”±äºhusky@6.0.0 ååšäº†breaking changeï¼Œæ‰€ä»¥åœ¨6.0.0ç‰ˆæœ¬ä¹‹å‰çš„é‚£ç§è®¾ç½®é’©å­çš„æ–¹æ³•å·²ç»ä¸é€‚ç”¨äº†,è¿™é‡Œæˆ‘ä»¬åªä»‹ç»æœ€æ–°çš„æ–¹å¼
å½“å‰é¡¹ç›®ä¸­åˆ›å»ºä¸€ä¸ª.huskyç›®å½•å¹¶æŒ‡å®šè¯¥ç›®å½•ä¸º git hooks æ‰€åœ¨çš„ç›®å½•ã€‚
ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¿«é€Ÿåˆ›å»º
```bash
#--no-install å‚æ•°è¡¨ç¤ºå¼ºåˆ¶npxä½¿ç”¨é¡¹ç›®ä¸­node_modulesç›®å½•ä¸‹çš„huskyä¾èµ–åŒ…
$ npx --no-install husky install
# error: fatal: ä¸æ˜¯ git ä»“åº“ï¼ˆæˆ–è€…ä»»ä½•çˆ¶ç›®å½•ï¼‰ï¼š.git (éœ€è¦æœ‰gitä¿¡æ¯)
# success: husky - Git hooks installed 
```

ä¸ºäº†è®©å…¶ä»–äººåœ¨æ­¤é¡¹ç›®ä¸­å®‰è£…ä¾èµ–åä¹Ÿèƒ½è‡ªåŠ¨åˆ›å»º.huskyç›®å½•å¹¶æŒ‡å®šè¯¥ç›®å½•ä¸º git hooks æ‰€åœ¨çš„ç›®å½•ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ package.json é‡Œé¢æ·»åŠ ä¸€æ¡è„šæœ¬"prepare": "husky install"
```bash
npm set-script prepare "husky install"
```
`package.json`
```json
  "scripts": {
    "dev": "vite",
    "build": "vue-tsc --noEmit && vite build",
    "preview": "vite preview",
    "prepare": "husky install" // å¤šäº†ä¸€æ¡å‘½ä»¤
  },
```

> prepare è„šæœ¬ä¼šåœ¨ npm iæˆ–è€…å…¶ä»–yarn or yarn add ä¹‹åè‡ªåŠ¨æ‰§è¡Œã€‚ä¹Ÿå°±æ˜¯è¯´å½“æˆ‘ä»¬å®‰è£…ä¾èµ–åä¼šè‡ªåŠ¨æ‰§è¡Œ husky install å‘½ä»¤ï¼Œä»è€Œè‡ªåŠ¨åˆ›å»º.huskyç›®å½•å¹¶æŒ‡å®šè¯¥ç›®å½•ä¸º git hooks æ‰€åœ¨çš„ç›®å½•ã€‚
`package.json`
```json
"scripts": { "lint": "eslint . --ext .vue,.js,.ts,.jsx,.tsx --fix" }
```
ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¿«é€Ÿåˆ›å»º
```bash
$ npx --no-install husky add .husky/pre-commit "npm run [ä½ è¦æ‰§è¡Œçš„å‘½ä»¤]"
# husky - created .husky/pre-commit
```
å®Œæˆå`.husky`ä¸‹ä¼šå¢åŠ ä¸€ä¸ª`pre-commitæ–‡ä»¶`å†…æœ‰å‘½ä»¤`"npm run lint"`,å…¶ä¸­çš„å†…å®¹ä¸º:
```
#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

npm run lint
```
è¿™é‡Œæˆ‘ç”¨çš„æ˜¯npm run lintï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é…åˆ Eslint çš„ä»£ç æ ¡éªŒ,æ¥é™åˆ¶ä¸è§„èŒƒä»£ç çš„æäº¤äº†
```bash
~/code/temp/study (master*) Â» git commit -m 'test: æµ‹è¯•æäº¤ä»£ç è§„èŒƒä½“éªŒ'    

> second@0.0.0 lint
> eslint . --ext .vue,.js,.ts,.jsx,.tsx --fix


/home/liming/code/temp/study/src/App.vue
  1:8  error  Parsing error: '>' expected
```

å¯ä»¥çœ‹åˆ°ï¼Œä¸ç¬¦åˆ Eslint æ ¡éªŒè§„åˆ™çš„ä»£ç æ˜¯æ²¡æ³•æäº¤çš„ï¼›
å½“ç„¶ï¼Œè¿™é‡Œçš„æŠ¥é”™é—®é¢˜åªæ˜¯ç”±äºç¼©è¿›ä¸è§„èŒƒå¼•èµ·çš„ï¼Œç±»ä¼¼è¿™ç§çš„é—®é¢˜è¿˜æœ‰å¼•å·ï¼Œå¥å°¾åˆ†å·ï¼Œæ¢è¡Œç¬¦ç­‰ç­‰...éƒ½å¯ä»¥é€šè¿‡ eslint çš„å‚æ•° --fixæ¥è‡ªåŠ¨ä¿®å¤ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨æäº¤å‰ï¼Œå…ˆå°†èƒ½å®ç°è‡ªåŠ¨ä¿®å¤çš„ç®€å•ä»£ç é£æ ¼é—®é¢˜å commitã€‚å¤æ‚çš„æƒ…å†µè¿˜æ˜¯è¦è‡ªå·±å»æ‰‹åŠ¨å¤„ç†çš„ã€‚
> è¯´åˆ°æ¢è¡Œç¬¦ï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦äº†è§£çš„æ˜¯ï¼šåœ¨ Windows ä¸Šé»˜è®¤çš„æ˜¯å›è½¦æ¢è¡Œï¼ˆCarriage Return Line Feed, CRLFï¼‰ï¼Œç„¶è€Œï¼Œåœ¨ Linux/MacOS ä¸Šåˆ™æ˜¯æ¢è¡Œï¼ˆLine Feed, LFï¼‰ã€‚

æˆ‘ä»¬å¯ä»¥è¯•ä¸€ä¸‹å°†åŸå…ˆæ¢è¡Œç¬¦ä¸ºcrlfçš„æ–‡ä»¶æ ¼å¼åŒ–ä¸ºæ¢è¡Œç¬¦ä¸ºlfåï¼Œæ‰§è¡Œ`git add .`çš„æƒ…å†µã€‚
```bash
~/code/temp/study (master*) Â» git add .   
```
å¯ä»¥çœ‹åˆ°æœ€ç»ˆ LF æ¢è¡Œç¬¦è¿˜æ˜¯è¢« CRLF è½¬åŒ–äº†ï¼›

å¦‚æœä½ ä»¬ä¸ä¼šè·¨å¹³å°åä½œï¼ˆéƒ½åœ¨ Mac/Linuxï¼Œæˆ–è€…éƒ½åœ¨ Windows ä¸ŠååŒï¼‰ï¼Œåªéœ€è¦åœ¨å½“å‰é¡¹ç›®ä¸­é€šè¿‡`git config core.autocrlf false`æ¥é˜»æ­¢è¿™ç§æƒ…å†µçš„å‘ç”Ÿã€‚

ä¸ºäº†ä¿é™©èµ·è§ï¼Œä½ éœ€è¦æ–°å»ºä¸€ä¸ª.gitattributesæ–‡ä»¶ï¼ˆä¸»è¦ç”¨äºå®šä¹‰æ¯ç§æ–‡ä»¶çš„å±æ€§ï¼Œä»¥æ–¹ä¾¿ git å¸®æˆ‘ä»¬ç»Ÿä¸€ç®¡ç†ã€‚ï¼‰ï¼Œè®¾ç½® eol(end of line)ä¸ºæŒ‡å®šçš„æ¢è¡Œç¬¦ï¼ˆlf/crlfï¼‰ï¼Œè¿™é‡Œæˆ‘æŠŠæ‰€æœ‰æ–‡ä»¶`*.*`çš„æ¢è¡Œç¬¦éƒ½è®¾ç½®ä¸ºäº† LFï¼Œå¹¶ä¸”å°†ä¸€äº›éæ–‡æœ¬æ–‡ä»¶è¿›è¡Œäº†æ ‡è®°ï¼ˆæ’é™¤å®ƒä»¬ï¼‰ï¼Œä½ ä¹Ÿå¯ä»¥å¯¹æ¯ä¸€ç§æ–‡ä»¶ç±»å‹åˆ†åˆ«è®¾ç½®å¯¹åº”çš„å±æ€§ => `*.js eol=lf`ï¼Œ`*.ts eol=lf`...
`.gitattributes`
```
*.* eol=lf
*.jpg -text
*.png -text
  ...
# æˆ–è€…

*.js eol=lf
*.ts eol=lf
*.json eol=lf
```

è¿™æ ·ï¼Œæˆ‘ä»¬ä¸ç®¡åœ¨ä»€ä¹ˆå¹³å°ä¸Šå¼€å‘ï¼Œæ–‡ä»¶æ¢è¡Œç¬¦éƒ½ç»Ÿä¸€ä¸º LFã€‚
å¯ä»¥çœ‹åˆ°ä½¿ç”¨.gitattributesé…ç½®æ–‡ä»¶åæ‰§è¡Œgit add,æ‰€æœ‰ä¸æ˜¯æŒ‡å®šæ¢è¡Œç¬¦çš„æ–‡ä»¶éƒ½ä¼šè¢«è‡ªåŠ¨æ›´æ¢ä¸ºä½ æŒ‡å®šçš„æ¢è¡Œç¬¦ï¼Œä¾‹å¦‚æˆ‘è¿™é‡ŒæŒ‡å®šäº†lf,é‚£ä¹ˆ git add . åï¼Œä¸æ˜¯ä»¥ lf æ¢è¡Œçš„æ–‡ä»¶éƒ½ä¼šè¢«è½¬æ¢ä¸º lf ï¼Œå¹¶åœ¨ç»ˆç«¯è¾“å‡ºwarning: CRLF will be replaced by LF in xxxx/filenameï¼Œå¦‚å›¾ 

`.gitattributes`æœ‰å¾ˆå¤šç”¨å¤„ï¼Œå…·ä½“å¯ä»¥æŸ¥çœ‹ [gitattributes](https://git-scm.com/docs/gitattributes)ã€‚


lint-staged
ä»€ä¹ˆæ˜¯lint-staged?é¡¾åæ€ä¹‰ï¼Œå€ŸåŠ©è¿™ä¸ªå·¥å…·åªæ˜¯ç”¨æ¥æ£€æŸ¥ git æš‚å­˜åŒºæ–‡ä»¶çš„ï¼Œå°±æ˜¯åœ¨ä½ `git add file1ï¼Œ2ï¼Œ3...` åçš„æš‚å­˜åŒºæ–‡ä»¶ä¸­è¿è¡Œ lint çš„ä¸€ä¸ªå·¥å…·ã€‚
æ¯æ¬¡æäº¤ä¸€ä¸¤ä¸ªæ–‡ä»¶ï¼Œå´éƒ½è¦ lint æ‰€æœ‰æ–‡ä»¶è¯ï¼Œæ˜¯å¾ˆæ²¡æœ‰å¿…è¦çš„ï¼Œæˆ‘ä»¬åªå¯¹éœ€è¦æäº¤çš„ä»£ç è¿›è¡Œ lint,è¿™æ ·å¯ä»¥å‡å°‘å¾ˆå¤šæ²¡å¿…è¦çš„æ—¶é—´å¼€é”€ã€‚ï¼ˆå¦‚æœä½ æ¯æ¬¡ä¿®æ”¹ä¸€ä¸ªæ–‡ä»¶ï¼Œéƒ½è¦å» lint æ‰€æœ‰æ–‡ä»¶ï¼Œè¿™ä¸ªå·¥å…·å¯¹ä½ æ¥è¯´å°±æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰äº†ï¼Œhusky å°±ç®¡å¤Ÿ ï¼‰

ä½¿ç”¨æ–¹æ³•
æˆ‘ä»¬å°†`.husky/pre-commit`ä¸­ä¹‹å‰å†™ä»£ç æ”¹ä¸º
```
#!/bin/sh
. "$(dirname "$0")/_/husky.sh"
- npm run lint
+ npx --no-install lint-staged
```
ç„¶ååœ¨ `package.json` ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ,`lint-staged`å¯¹è±¡ä¸­é‡‡ç”¨é”®å€¼å¯¹çš„æ–¹å¼è¿›è¡Œé…ç½®ï¼Œé”®åæ˜¯ä½ æƒ³å¤„ç†çš„å•ä¸ªæ–‡ä»¶æˆ–ä¸€ä¸ªæ–‡ä»¶ç±»å‹ï¼Œå¤šä¸ªç±»å‹å¯ä»¥å†™åœ¨`{}`ä¸­ï¼Œç”¨é€—å·åˆ†éš”ï¼›é”®å€¼æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„ä¸­ä¸º lint æ—¶éœ€è¦æ‰§è¡Œçš„å‘½ä»¤ç»„ã€‚
```json
  "lint-staged": {
    "*.{ts,js,vue}": [
      "eslint",
      "echo 'æ²¡é—®é¢˜ï¼'"
    ]
  }
```
æˆ–è€…åœ¨æ ¹ç›®å½•æ·»åŠ `.lintstagedrc.json`æ–‡ä»¶
```json
{
   "*.{ts,js,vue}": [
      "eslint",
      "echo 'æ²¡é—®é¢˜ï¼'"
    ]
}
// admin
{
  "*{.js,.jsx,.ts,.tsx,.vue}": ["prettier --write", "cross-env NODE_ENV=production eslint --fix"]
}
```
æ·»åŠ ç©ä¸Šè¿°ä»£ç åï¼Œæˆ‘ä»¬é€šè¿‡æµ‹è¯•ï¼Œå°†ä¸¤ä¸ªæ–‡ä»¶çš„ç¼©è¿›æ”¹ä¸ºä¸ç¬¦åˆè§„èŒƒçš„æƒ…å†µï¼Œç„¶åå°†å…¶ä¸­ä¸€ä¸ªæ–‡ä»¶æš‚å­˜åï¼Œæˆ‘ä»¬è¿è¡Œgit commitåå‘ç°ç»ˆç«¯çš„æŠ¥é”™ä¸­ï¼Œåªæœ‰ä¸€ä¸ªæ–‡ä»¶çš„ lint æŠ¥é”™ä¿¡æ¯,å¦ä¸€ä¸ªæ–‡ä»¶çš„æŠ¥é”™å¹¶æ²¡æœ‰å‡ºç°ã€‚

å½“æ‰€æœ‰æš‚å­˜åŒºä»£ç éƒ½ç¬¦åˆè§„èŒƒæ—¶ï¼Œæ‰ä¼šé€šè¿‡æ ¡éªŒæ‰§è¡Œæäº¤ã€‚
```bash
âœ” Preparing lint-staged...
âœ” Hiding unstaged changes to partially staged files...
âœ” Running tasks for staged files...
âœ” Restoring unstaged changes to partially staged files...
âœ” Cleaning up temporary files...
```

commitizen
Commitizen æ˜¯ä¸€ä¸ªæ’°å†™ç¬¦åˆä¸Šé¢ Commit Message æ ‡å‡†çš„ä¸€æ¬¾å·¥å…·ã€‚é€šè¿‡å®ƒå¯ä»¥å®ç°äº¤äº’å¼æ’°å†™è§„èŒƒçš„ Commit Messageã€‚
```bash
# å¦‚æœåªåœ¨æœ¬ä»“åº“ä½¿ç”¨
$ npm install commitizen -D
# å¦‚æœä½ æƒ³å…¨å±€éƒ½ç”¨ commitizen æ¥å¸®ä½ åš commit
$ npm install commitizen -g
```
å®‰è£…å®Œæˆåï¼Œä¸€èˆ¬æˆ‘ä»¬éƒ½é‡‡ç”¨ç¬¦åˆ Angular çš„ Commit message æ ¼å¼çš„æäº¤è§„èŒƒï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ï¼Œåé¢ä¼šè®²åˆ°~ï¼‰ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ç”Ÿæˆç¬¦åˆ Angular æäº¤è§„èŒƒæ ¼å¼çš„ Commit messageã€‚
```bash
# ä½ é¡¹ç›®ç”¨çš„æ˜¯ npm
npx --no-install commitizen init cz-conventional-changelog --save-dev --save-exact
# å¦‚æœä½ é¡¹ç›®ç”¨çš„æ˜¯yarn
npx --no-install commitizen init cz-conventional-changelog --yarn --dev --exact
# å¦‚æœä½ é¡¹ç›®ç”¨çš„æ˜¯pnpm
npx --no-install commitizen init cz-conventional-changelog --save-dev --save-exact
```

è¿è¡Œäº†ä¸Šè¿°å‘½ä»¤åï¼Œå®ƒå°†ä¸ºä½ é¡¹ç›®å®‰è£… cz-conventional-changelog é€‚é…å™¨æ¨¡å—ï¼ŒæŠŠ config.commitizen çš„å¯†é’¥æ·»åŠ åˆ°æ–‡ä»¶çš„æ ¹ç›®å½•æ·»åŠ åˆ° package.json ä¸­
å¯ä»¥åœ¨package.json ä¸­çœ‹åˆ°ï¼Œè‡ªåŠ¨çš„æ–°å¢äº†ä»¥ä¸‹å†…å®¹
```json
{
  ...
  "config": {
    "commitizen": {
      "path": "./node_modules/cz-conventional-changelog"
    }
  }
  ...
}
```
å®Œæˆåï¼Œé€šè¿‡å‘½ä»¤yarn czï¼Œä½ å¦‚æœæ˜¯å…¨å±€å®‰è£…çš„ commitizenï¼Œé‚£ä½ ç›´æ¥ git czï¼Œéƒ½å¯ä»¥é€šè¿‡ä»¥ä¸‹äº¤äº’å¼çš„æ’°å†™ commit messag ç„¶åæäº¤

### é™åˆ¶ commitlint
ç”±äº commitizen å¹¶ä¸æ˜¯å¼ºåˆ¶ä½¿ç”¨çš„ï¼Œä»ç„¶å¯ä»¥é€šè¿‡git commitæ¥æäº¤ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»åœ¨ä¸ç®¡æ˜¯é€šè¿‡czè¿˜æ˜¯git commitæäº¤å‰ï¼Œéƒ½è¦å¯¹ commit messag è¿›è¡Œä¸€æ¬¡æ ¡éªŒï¼Œä¸ç¬¦åˆè§„èŒƒçš„æƒ…å†µä¸‹æ˜¯ä¸å…è®¸è¿›è¡Œ commit çš„

é¦–å…ˆæˆ‘ä»¬éœ€è¦å®‰è£…commitlint,commitlint/config-conventional
```bash
yarn add @commitlint/cli @commitlint/config-conventional -D
```
ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¿«é€Ÿåˆ›å»º git hooks çš„ commit-msg é’©å­, è¿™æ ·æ¯æ¬¡ commit çš„æ—¶å€™éƒ½ä¼šç”± commitlint å¯¹ commit message è¿›è¡Œä¸€æ¬¡æ£€éªŒ
```bash
npx --no-instal husky add .husky/commit-msg 'npx --no-install commitlint --edit "$1"'
```
ç„¶åæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªcommitlint é…ç½®æ–‡ä»¶commitlint.config.js åˆ°é¡¹ç›®æ ¹ç›®å½•
ä»–å°†ç»§æ‰¿@commitlint/config-conventionalä¸­çš„ Commit message è§„èŒƒã€‚ï¼ˆ"feat", "fix", "perf", "refactor"...ï¼‰
```js
module.exports = {
  extends: ["@commitlint/config-conventional"],
};
```
ç„¶åæˆ‘ä»¬åœ¨ç»ˆç«¯è¿›è¡Œæµ‹è¯•
```bash
echo 'feat: bar' | npx --no-install commitlint
```
å¯ä»¥çœ‹åˆ°ï¼Œä¸ç¬¦åˆè§„èŒƒçš„ commit-msg æ˜¯ä¼šå¯¼è‡´æŠ¥é”™çš„ï¼Œä¹Ÿå°± commit ä¸äº†äº†ï¼Œè¯´æ˜æˆ‘ä»¬çš„ commitlint å·²ç»ç”Ÿæ•ˆäº†
![](assets/images/2022-09-04_13-35.png)

åˆ°æ­¤ï¼Œcommit-msg çš„æ ¡éªŒä¹Ÿå·²ç»å®Œæˆ âœ”

å¦‚æœï¼Œä½ æƒ³è‡ªå®šä¹‰ commitlint çš„äº¤äº’æ–‡æœ¬ï¼ˆä¸ç”¨ featï¼Œfix...ï¼Œå¾ˆå¤šäººéƒ½å–œæ¬¢åœ¨ commit message å‰é¢åŠ ä¸€ä¸ª emoji è¡¨æƒ…ç¬¦å·ï¼‰ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ã€‚
```bash
yarn add commitlint-config-cz  cz-customizable -D
```
åœ¨é¡¹ç›®æ ¹ç›®å½•ï¼Œåˆ›å»ºä¸€ä¸ª`.cz-config.js`æ–‡ä»¶ï¼Œå¹¶å¤åˆ¶[cz-config-EXAMPLE.js](https://github.com/leoforfree/cz-customizable/blob/master/cz-config-EXAMPLE.js) ä¸­çš„å†…å®¹åˆ°å…¶ä¸­ã€‚ç„¶åæ”¹æˆä½ è‡ªå·±æƒ³è¦çš„è§„åˆ™å³å¯ã€‚
```js
module.exports = {
  types: [
    { value: "feat", name: "feat: ä¸€ä¸ªæ–°çš„ç‰¹æ€§" },
    { value: "fix", name: "fix: ä¿®å¤ä¸€ä¸ªBug" },
    { value: "docs", name: "docs: å˜æ›´çš„åªæœ‰æ–‡æ¡£" },
    { value: "style", name: "style: ä»£ç é£æ ¼,æ ¼å¼ä¿®å¤" },
    { value: "refactor", name: "refactor: ä»£ç é‡æ„ï¼Œæ³¨æ„å’Œfeatã€fixåŒºåˆ†å¼€" },
    { value: "perf", name: "perf: ç ä¼˜åŒ–,æ”¹å–„æ€§èƒ½" },
    { value: "test", name: "test: æµ‹è¯•" },
    { alue: "chore", name: "chore: å˜æ›´æ„å»ºæµç¨‹æˆ–è¾…åŠ©å·¥å…·" },
    { value: "revert", name: "revert: ä»£ç å›é€€" },
    { value: "init", name: "init: é¡¹ç›®åˆå§‹åŒ–" },
    { value: "build", name: "build: å˜æ›´é¡¹ç›®æ„å»ºæˆ–å¤–éƒ¨ä¾èµ–" },
    { value: "WIP", name: "WIP: è¿›è¡Œä¸­çš„å·¥ä½œ" },
  ],
  scopes: [],
  allowTicketNumber: false,
  isTicketNumberRequired: false,
  ticketNumberPrefix: "TICKET-",
  ticketNumberRegExp: "\\d{1,5}",
  // it needs to match the value for field type. Eg.: 'fix'
  /*
  scopeOverrides: {
    fix: [
      {name: 'merge'},
      {name: 'style'},
      {name: 'e2eTest'},
      {name: 'unitTest'}
    ]
  },
  */
  // override the messages, defaults are as follows
  messages: {
    type: "é€‰æ‹©ä¸€ç§ä½ çš„æäº¤ç±»å‹:",
    scope: "é€‰æ‹©ä¸€ä¸ªscope (å¯é€‰):",
    // used if allowCustomScopes is true
    customScope: "Denote the SCOPE of this change:",
    subject: "ç®€çŸ­è¯´æ˜(æœ€å¤š40ä¸ªå­—):",
    body: 'é•¿è¯´æ˜ï¼Œä½¿ç”¨"|"æ¢è¡Œ(å¯é€‰)ï¼š\n',
    breaking: "éå…¼å®¹æ€§è¯´æ˜ (å¯é€‰):\n",
    footer: "å…³è”å…³é—­çš„issueï¼Œä¾‹å¦‚ï¼š#12, #34(å¯é€‰):\n",
    confirmCommit: "ç¡®å®šæäº¤?",
  },
  allowCustomScopes: true,
  allowBreakingChanges: ["feat", "fix"],
  // skip any questions you want
  skipQuestions: ["scope", "body", "breaking"],
  // limit subject length
  subjectLimit: 100,
  // breaklineChar: '|', // It is supported for fields body and footer.
  // footerPrefix : 'ISSUES CLOSED:'
  // askForBreakingChangeFirst : true, // default is false
};
```
åˆ›å»ºå®Œ.cz-config.jsæ–‡ä»¶åï¼Œæˆ‘ä»¬éœ€è¦å›åˆ° package.json æ–‡ä»¶ä¸­ï¼Œå°† config.commitizen.path æ›´æ”¹ä¸º"node_modules/cz-customizable",å¦‚æœä½ çš„.cz-config.jsæ–‡ä»¶åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼Œé‚£ä¹ˆå¯ä»¥ä¸é…ç½®ä¸‹é¢è¿™æ¡ï¼Œcommitlint-config-cz ä¼šè‡ªåŠ¨åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹å¯»æ‰¾: .cz-config.jsæˆ– .config/cz-config.js
```json
...
{
  "config": {
    "commitizen": {
      "path": "node_modules/cz-customizable"
    },
    // å¦‚æœä½ çš„.cz-config.jsæ–‡ä»¶åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼Œé‚£ä¹ˆå¯ä»¥ä¸é…ç½®ä¸‹é¢è¿™æ¡ï¼Œcommitlint-config-czä¼šè‡ªåŠ¨åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹å¯»æ‰¾: .cz-config.js æˆ– .config/cz-config.js
    "cz-customizable": {
      "config": "ä½ çš„æ–‡ä»¶è·¯å¾„/xxxconfig.js"
    }
  }
}
...
```
å…³äºcommitlint-config-czæ›´é«˜çº§çš„ç”¨æ³•å¯ä»¥æŸ¥çœ‹ ğŸ‘‰[commitlint-config-cz](https://github.com/whizark/commitlint-config-cz)
æœ€åæˆ‘ä»¬å°†ä¹‹å‰åˆ›å»ºè¿‡çš„commitlint.config.jsä¸­çš„ä»£ç è¿›è¡Œæ›´æ”¹ 
```js
module.exports = {
- extends: ["@commitlint/config-conventional"],
+ extends: ["cz"],
};
```
æˆ–è€…ä½ ä¹Ÿå¯ä»¥åœ¨commitlint.config.jsä¸­æ‰‹åŠ¨æ·»åŠ è‡ªå®šä¹‰çš„è§„åˆ™ ,ä»–å°†è¦†ç›– extends ä¸­çš„è§„åˆ™
```js

module.exports = {
  extends: ["@commitlint/config-conventional"ï¼Œ"cz"],
  rules: {
    "type-enum": [
      2,
      "always",
      [
        "init",
        "build",
        "ci",
        "chore",
        "docs",
        "feat",
        "fix",
        "perf",
        "refactor",
        "revert",
        "style",
        "test",
      ],
    ],
  },
};
```
## å¢åŠ æ‰“åŒ…æ¡ä»¶ã€çº¿ä¸Šè¿ç»´ç›‘æ§




## å¢åŠ æ ·å¼ä¸äº¤äº’ä¼˜åŒ–